#find_program (BOX_EXEC NAMES box php-box box.phar)
#find_program (APIGEN_EXEC NAMES apigen php-apigen apigen.phar)
set(BOX_EXEC php box.phar)
set(APIGEN_EXEC php apigen.phar)
add_custom_command(OUTPUT box.phar COMMAND curl -LSs https://box-project.github.io/box2/installer.php | php)
add_custom_command(OUTPUT apigen.phar COMMAND curl -L -O https://github.com/ApiGen/ApiGen.github.io/raw/master/apigen.phar)
add_custom_command(OUTPUT index.php COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/index.php ${CMAKE_CURRENT_BINARY_DIR} MAIN_DEPENDENCY index.php)
add_custom_command(OUTPUT autoload.php grandet grandet.proto.php COMMAND ${PROTOBUF_PROTOC_EXECUTABLE} --php_out=${CMAKE_CURRENT_BINARY_DIR} --plugin=../external/protoc-gen-php/bin/protoc-gen-php grandet.proto WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}/proto MAIN_DEPENDENCY ${CMAKE_SOURCE_DIR}/proto/grandet.proto)
add_custom_command(OUTPUT box.json COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/box.json ${CMAKE_CURRENT_BINARY_DIR} MAIN_DEPENDENCY box.json)
add_custom_command(OUTPUT test.php COMMAND ${CMAKE_COMMAND} -E copy ${CMAKE_CURRENT_SOURCE_DIR}/test.php ${CMAKE_CURRENT_BINARY_DIR} MAIN_DEPENDENCY test.php)
add_custom_command(OUTPUT grandet.phar COMMAND ${BOX_EXEC} build DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/box.json ${CMAKE_CURRENT_BINARY_DIR}/index.php ${CMAKE_CURRENT_BINARY_DIR}/autoload.php ${CMAKE_CURRENT_BINARY_DIR}/grandet ${CMAKE_CURRENT_BINARY_DIR}/grandet.proto.php box.phar)
add_custom_command(OUTPUT docs COMMAND ${APIGEN_EXEC} generate -s ${CMAKE_CURRENT_SOURCE_DIR} -d docs MAIN_DEPENDENCY index.php DEPENDS apigen.phar)
add_custom_target(php DEPENDS grandet.phar)
add_custom_target(php_test DEPENDS test.php)
add_custom_target(php_docs DEPENDS docs)
